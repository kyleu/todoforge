{% import (
  "fmt"
  "strings"

  "github.com/kyleu/todoforge/app"
  "github.com/kyleu/todoforge/app/controller/cutil"
  "github.com/kyleu/todoforge/app/util"
  "github.com/kyleu/todoforge/views/components/edit"
  "github.com/kyleu/todoforge/views/layout"
) %}

{% code type Args struct {
  layout.Basic
  URL string
  Directions string
  Results *util.FieldDescResults
  Hidden map[string]string
  Warning string
} %}

{% func (p *Args) Body(as *app.State, ps *cutil.PageState) %}
  <div class="card">
    <h3>{% if p.Directions == "" %}Enter Data{% else %}{%s p.Directions %}{% endif %}</h3>
    {%- code
      onsubmit := ""
      if p.Warning != "" {
        onsubmit = fmt.Sprintf(` onsubmit="return confirm('%s')"`, strings.ReplaceAll(strings.ReplaceAll(p.Warning, "'", "\\'"), "\"", ""))
      }
    -%}
    <form action="{%s p.URL %}" method="get"{%s= onsubmit %}">
      {%- for k, v := range p.Hidden -%}
      <input type="hidden" name="{%s k %}" value="{%s v %}" />
      {%- endfor -%}
      {%= edit.TableEditorNoForm("args", p.Results.FieldDescs, p.Results.Values, "", "", "Submit") %}
    </form>
  </div>
{% endfunc %}
